{
  "info": {
    "name": "Google OAuth Complete Testing",
    "description": "Complete testing suite for Google OAuth authentication with detailed examples and test scripts",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "sessionId",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    },
    {
      "key": "userEmail",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "ðŸ” 1. Google OAuth Authentication",
      "item": [
        {
          "name": "Login as CUSTOMER (No Step-Up)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test: Response status should be 200",
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Test: Response should be JSON",
                  "pm.test('Response is JSON', function () {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "// Parse response",
                  "const response = pm.response.json();",
                  "",
                  "// Test: Success flag should be true",
                  "pm.test('Success flag is true', function () {",
                  "    pm.expect(response.success).to.be.true;",
                  "});",
                  "",
                  "// Test: Should not require step-up for CUSTOMER",
                  "pm.test('Step-up not required for CUSTOMER', function () {",
                  "    pm.expect(response.requiresStepUp).to.be.undefined;",
                  "});",
                  "",
                  "// Test: User data should exist",
                  "pm.test('User data exists', function () {",
                  "    pm.expect(response.data.user).to.exist;",
                  "    pm.expect(response.data.user.email).to.exist;",
                  "    pm.expect(response.data.user.role).to.equal('CUSTOMER');",
                  "});",
                  "",
                  "// Test: Session data should exist",
                  "pm.test('Session data exists', function () {",
                  "    pm.expect(response.data.session).to.exist;",
                  "    pm.expect(response.data.session.accessToken).to.exist;",
                  "    pm.expect(response.data.session.refreshToken).to.exist;",
                  "});",
                  "",
                  "// Save tokens to environment",
                  "if (response.data.session) {",
                  "    pm.collectionVariables.set('accessToken', response.data.session.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', response.data.session.refreshToken);",
                  "    pm.collectionVariables.set('userId', response.data.user.id);",
                  "    pm.collectionVariables.set('userEmail', response.data.user.email);",
                  "    console.log('âœ… Tokens saved to environment');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"idToken\": \"PASTE_YOUR_GOOGLE_ID_TOKEN_HERE\",\n  \"requestedRole\": \"CUSTOMER\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/google",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "google"]
            },
            "description": "**How to get Google idToken:**\n\n1. Go to https://developers.google.com/oauthplayground/\n2. Click Settings (âš™ï¸) > Use your own OAuth credentials\n3. Enter your Client ID and Secret\n4. Select 'Google OAuth2 API v2' scopes (email, profile)\n5. Click 'Authorize APIs'\n6. Sign in with Google\n7. Click 'Exchange authorization code for tokens'\n8. Copy the 'id_token' value\n\n**Expected Result:**\n- Status: 200 OK\n- Returns user data and session tokens\n- No step-up verification required for CUSTOMER role"
          },
          "response": []
        }
      ]
    }
  ]
}
