{
  "info": {
    "name": "EMDR - Provider Signup & Onboarding (Complete)",
    "description": "Complete provider registration and onboarding flow with all steps",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000/api/v1"
    },
    {
      "key": "email",
      "value": ""
    },
    {
      "key": "otp",
      "value": ""
    },
    {
      "key": "tempToken",
      "value": ""
    },
    {
      "key": "token",
      "value": ""
    },
    {
      "key": "providerId",
      "value": ""
    },
    {
      "key": "profileId",
      "value": ""
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "console.log('\\n' + '='.repeat(60));",
          "console.log('üöÄ REQUEST:', pm.request.method, pm.request.name);",
          "console.log('üìç URL:', pm.request.url.toString());",
          "console.log('='.repeat(60));"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "if (pm.response.code >= 200 && pm.response.code < 300) {",
          "    try {",
          "        const response = pm.response.json();",
          "        console.log('‚úÖ Response:', JSON.stringify(response, null, 2));",
          "    } catch(e) {}",
          "}",
          "",
          "console.log('üìä Status:', pm.response.code);",
          "console.log('‚è±Ô∏è  Time:', pm.response.responseTime + 'ms');",
          "console.log('='.repeat(60) + '\\n');"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "üìÅ Step 1: Register Email",
      "item": [
        {
          "name": "1. Register Email & Send OTP",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const res = pm.response.json();",
                  "    ",
                  "    console.log('\\n‚úÖ EMAIL REGISTERED');",
                  "    console.log('‚îÅ'.repeat(60));",
                  "    console.log('üìß Email:', pm.request.body.raw ? JSON.parse(pm.request.body.raw).email : 'N/A');",
                  "    console.log('üì® OTP sent to email');",
                  "    console.log('‚è∞ OTP expires in 10 minutes');",
                  "    console.log('‚îÅ'.repeat(60));",
                  "    console.log('\\n‚ö†Ô∏è  CHECK YOUR EMAIL FOR OTP CODE');",
                  "    ",
                  "    // Save email",
                  "    const body = JSON.parse(pm.request.body.raw);",
                  "    pm.collectionVariables.set('email', body.email);",
                  "}",
                  "",
                  "pm.test('‚úÖ Email registered', () => {",
                  "    pm.response.to.have.status(200);",
                  "    const res = pm.response.json();",
                  "    pm.expect(res.success).to.be.true;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"provider@example.com\",\n  \"fullName\": \"Restaurant Owner\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/provider/register-email",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "provider", "register-email"]
            }
          }
        }
      ]
    },
    {
      "name": "üìÅ Step 2: Verify OTP",
      "item": [
        {
          "name": "2. Verify Email OTP",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const res = pm.response.json();",
                  "    ",
                  "    if (res.success && res.data && res.data.tempToken) {",
                  "        pm.collectionVariables.set('tempToken', res.data.tempToken);",
                  "        ",
                  "        console.log('\\n‚úÖ OTP VERIFIED');",
                  "        console.log('‚îÅ'.repeat(60));",
                  "        console.log('üîë Temp Token saved');",
                  "        console.log('üìß Email verified successfully');",
                  "        console.log('‚û°Ô∏è  Next: Set password');",
                  "        console.log('‚îÅ'.repeat(60));",
                  "    }",
                  "}",
                  "",
                  "pm.test('‚úÖ OTP verified', () => {",
                  "    pm.response.to.have.status(200);",
                  "    const res = pm.response.json();",
                  "    pm.expect(res.success).to.be.true;",
                  "    pm.expect(res.data.tempToken).to.exist;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{email}}\",\n  \"otp\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/provider/verify-email-otp",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "provider", "verify-email-otp"]
            }
          }
        }
      ]
    },
    {
      "name": "üìÅ Step 3: Set Password",
      "item": [
        {
          "name": "3. Set Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const res = pm.response.json();",
                  "    ",
                  "    if (res.success && res.data && res.data.token) {",
                  "        pm.collectionVariables.set('token', res.data.token);",
                  "        ",
                  "        if (res.data.user) {",
                  "            pm.collectionVariables.set('providerId', res.data.user._id || res.data.user.id);",
                  "        }",
                  "        ",
                  "        console.log('\\n‚úÖ PASSWORD SET');",
                  "        console.log('‚îÅ'.repeat(60));",
                  "        console.log('üîë Token saved');",
                  "        console.log('üë§ Provider ID:', pm.collectionVariables.get('providerId'));",
                  "        console.log('‚úÖ Account created successfully');",
                  "        console.log('‚û°Ô∏è  Next: Submit restaurant info');",
                  "        console.log('‚îÅ'.repeat(60));",
                  "    }",
                  "}",
                  "",
                  "pm.test('‚úÖ Password set', () => {",
                  "    pm.response.to.have.status(200);",
                  "    const res = pm.response.json();",
                  "    pm.expect(res.success).to.be.true;",
                  "    pm.expect(res.data.token).to.exist;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tempToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"password\": \"SecurePassword123!\",\n  \"confirmPassword\": \"SecurePassword123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/provider/set-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "provider", "set-password"]
            }
          }
        }
      ]
    },
    {
      "name": "üìÅ Step 4: Restaurant Info",
      "item": [
        {
          "name": "4. Submit Restaurant Info (with Image)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    ",
                  "    if (res.success && res.data) {",
                  "        if (res.data._id) {",
                  "            pm.collectionVariables.set('profileId', res.data._id);",
                  "        }",
                  "        ",
                  "        console.log('\\n‚úÖ RESTAURANT INFO SUBMITTED');",
                  "        console.log('‚îÅ'.repeat(60));",
                  "        console.log('üè™ Restaurant:', res.data.restaurantName);",
                  "        console.log('üìç Location:', res.data.city + ', ' + res.data.state);",
                  "        console.log('üìß Email:', res.data.contactEmail);",
                  "        console.log('üìû Phone:', res.data.phoneNumber);",
                  "        console.log('üçΩÔ∏è  Cuisine:', res.data.cuisine ? res.data.cuisine.join(', ') : 'N/A');",
                  "        console.log('‚û°Ô∏è  Next: Upload documents');",
                  "        console.log('‚îÅ'.repeat(60));",
                  "    }",
                  "}",
                  "",
                  "pm.test('‚úÖ Restaurant info submitted', () => {",
                  "    pm.response.to.have.status([200, 201]);",
                  "    const res = pm.response.json();",
                  "    pm.expect(res.success).to.be.true;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "restaurantName",
                  "value": "Pizza Paradise",
                  "type": "text"
                },
                {
                  "key": "contactEmail",
                  "value": "info@pizzaparadise.com",
                  "type": "text"
                },
                {
                  "key": "phoneNumber",
                  "value": "+1-555-0123",
                  "type": "text"
                },
                {
                  "key": "restaurantAddress",
                  "value": "123 Main Street",
                  "type": "text"
                },
                {
                  "key": "city",
                  "value": "New York",
                  "type": "text"
                },
                {
                  "key": "state",
                  "value": "NY",
                  "type": "text"
                },
                {
                  "key": "zipCode",
                  "value": "10001",
                  "type": "text"
                },
                {
                  "key": "cuisine",
                  "value": "Italian,Pizza,Pasta",
                  "type": "text",
                  "description": "Comma-separated values"
                },
                {
                  "key": "restturanImage",
                  "type": "file",
                  "src": [],
                  "description": "Restaurant profile image"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/provider/onboarding/restaurant-info",
              "host": ["{{baseUrl}}"],
              "path": ["provider", "onboarding", "restaurant-info"]
            }
          }
        }
      ]
    },
    {
      "name": "üìÅ Step 5: Upload Documents",
      "item": [
        {
          "name": "5. Upload Required Documents",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const res = pm.response.json();",
                  "    ",
                  "    console.log('\\n‚úÖ DOCUMENTS UPLOADED');",
                  "    console.log('‚îÅ'.repeat(60));",
                  "    console.log('üìÑ Documents submitted successfully');",
                  "    console.log('‚è≥ Status: Pending admin approval');",
                  "    console.log('‚û°Ô∏è  Next: Wait for admin verification');",
                  "    console.log('‚îÅ'.repeat(60));",
                  "}",
                  "",
                  "pm.test('‚úÖ Documents uploaded', () => {",
                  "    pm.response.to.have.status(200);",
                  "    const res = pm.response.json();",
                  "    pm.expect(res.success).to.be.true;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "businessLicenseFile",
                  "type": "file",
                  "src": [],
                  "description": "Business license document"
                },
                {
                  "key": "healthPermitFile",
                  "type": "file",
                  "src": [],
                  "description": "Health permit document"
                },
                {
                  "key": "stateOrCityLicenseFile",
                  "type": "file",
                  "src": [],
                  "description": "State/City license"
                },
                {
                  "key": "proofOfAddressFile",
                  "type": "file",
                  "src": [],
                  "description": "Proof of address"
                },
                {
                  "key": "ownerGovernmentID",
                  "type": "file",
                  "src": [],
                  "description": "Owner's government ID"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/provider/onboarding/documents",
              "host": ["{{baseUrl}}"],
              "path": ["provider", "onboarding", "documents"]
            }
          }
        }
      ]
    },
    {
      "name": "üìÅ Step 6: Check Status",
      "item": [
        {
          "name": "6. Check Onboarding Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const res = pm.response.json();",
                  "    ",
                  "    if (res.success && res.data) {",
                  "        console.log('\\n‚úÖ ONBOARDING STATUS');",
                  "        console.log('‚îÅ'.repeat(60));",
                  "        console.log('üìä Status:', res.data.verificationStatus);",
                  "        console.log('‚úÖ Verified:', res.data.isVerify ? 'Yes' : 'No');",
                  "        console.log('üè™ Active:', res.data.isActive ? 'Yes' : 'No');",
                  "        ",
                  "        if (res.data.verificationStatus === 'PENDING') {",
                  "            console.log('\\n‚è≥ Waiting for admin approval');",
                  "        } else if (res.data.verificationStatus === 'APPROVED') {",
                  "            console.log('\\n‚úÖ Account approved! You can start adding foods');",
                  "        } else if (res.data.verificationStatus === 'REJECTED') {",
                  "            console.log('\\n‚ùå Account rejected');",
                  "            if (res.data.blockReason) {",
                  "                console.log('   Reason:', res.data.blockReason);",
                  "            }",
                  "        }",
                  "        console.log('‚îÅ'.repeat(60));",
                  "    }",
                  "}",
                  "",
                  "pm.test('‚úÖ Status retrieved', () => {",
                  "    pm.response.to.have.status(200);",
                  "    const res = pm.response.json();",
                  "    pm.expect(res.success).to.be.true;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/provider/onboarding/status",
              "host": ["{{baseUrl}}"],
              "path": ["provider", "onboarding", "status"]
            }
          }
        }
      ]
    },
    {
      "name": "üìÅ Admin Actions",
      "item": [
        {
          "name": "Admin: Get Pending Providers",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "description": "Admin token required"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/providers/pending",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "providers", "pending"]
            }
          }
        },
        {
          "name": "Admin: Get Provider Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/providers/{{providerId}}/verification-details",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "providers", "{{providerId}}", "verification-details"]
            }
          }
        },
        {
          "name": "Admin: Approve Provider",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"approve\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/providers/{{providerId}}/verify",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "providers", "{{providerId}}", "verify"]
            }
          }
        },
        {
          "name": "Admin: Reject Provider",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"reject\",\n  \"reason\": \"Incomplete documentation\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/providers/{{providerId}}/verify",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "providers", "{{providerId}}", "verify"]
            }
          }
        }
      ]
    }
  ]
}
